<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estátisticas</title>
    <link rel="stylesheet" href="css/quiz.css">
    <link rel="icon" href="./assets/icon/iconTs2.jpg" />
</head>

<body onload="mostrarAcerto(), mostrarRanking(), mostrarGrafico()">

    <div id="fimQuiz">

    </div>

    <div id="mostrarRank">
        <h1>Ranking</h1>
        <h3>Posição | Usuário | Pontuação</h3>
    </div>

    <div id="mostrarGrafico">
        <canvas id="myChart"></canvas>
    </div>

    <div id="btn-home">
        <button onclick="irParaHome()">Home</button>
    </div>
</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>

    var qtdCerta = 0;
    var frase = "";
    function mostrarAcerto() {

        //ele só pega - fetch em português é buscar/trazer
        fetch(`/questaoCertas/mostrarAcerto/${sessionStorage.getItem(`idUsuario`)}`, {

            // Vai executar
        }).then(function (resposta) {

            // Vai retornar um vetor = (resposta)
            if (resposta.status == 201) {
                resposta.json().then(resposta => {
                    qtdCerta = resposta[0].quantCerta;
                    fimQuiz.innerHTML = ` <h1>Você acertou: ${qtdCerta} de 13 perguntas</h1>
            <div id="mostrarMensagem"></div>`
                })
            }
            setTimeout(() => {
                if (qtdCerta <= 5) {
                    frase = `Um mero mortal!`

                } else if (qtdCerta > 5 && qtdCerta <= 8) {
                    frase = `Até que tem bom gosto!`

                } else {
                    frase = `Olha só!!! Temos um swifter entre nós!`
                }
                mostrarMensagem.innerHTML = `${frase}`
            }, 1000)

        })
    }

    function mostrarRanking() {

        //ele só pega
        fetch(`/questaoCertas/mostrarRanking/`, {

            // Vai executar
        }).then(function (resposta) {

            // Vai retornar um vetor = (resposta)
            if (resposta.status == 201) {
                resposta.json().then(res => {


                    for (var contador = 0; contador < res.length; contador++) {
                        mostrarRank.innerHTML += `
                        ${contador + 1}º ${res[contador].nomeUsuario} ${res[contador].Quantidade_de_acertos}<br>
                        `

                    }

                })
            }

        })
    }

    function mostrarGrafico() {
        //ele só pega
        fetch(`/questaoCertas/mostrarGrafico`, {

            // Vai executar
        }).then(function (resposta) {

            // Vai retornar um vetor = (resposta)
            if (resposta.status == 201) {
                resposta.json().then(resposta => {

                    const ctx = document.getElementById('myChart');

                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['0-5', '6-8', '9-13'],
                            datasets: [{
                                label: '..............',
                                data: [resposta[0].Menor_Que_Cinco, resposta[0].Menor_Que_8, resposta[0].Maior_Que_8],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });


                })
            }

        })
    }


function irParaHome() {

    window.location = 'index.html';
}
</script>